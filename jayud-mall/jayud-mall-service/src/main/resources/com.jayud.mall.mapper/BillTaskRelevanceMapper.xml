<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jayud.mall.mapper.BillTaskRelevanceMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.jayud.mall.model.po.BillTaskRelevance">
        <id column="id" property="id" />
        <result column="ocean_bill_id" property="oceanBillId" />
        <result column="task_code" property="taskCode" />
        <result column="task_name" property="taskName" />
        <result column="sort" property="sort" />
        <result column="days" property="days" />
        <result column="day_flag" property="dayFlag" />
        <result column="operators" property="operators" />
        <result column="minutes" property="minutes" />
        <result column="score" property="score" />
        <result column="remarks" property="remarks" />
        <result column="status" property="status" />
        <result column="reason" property="reason" />
        <result column="up_time" property="upTime" />
        <result column="user_id" property="userId" />
        <result column="user_name" property="userName" />
        <result column="create_time" property="createTime" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, ocean_bill_id, task_code, task_name, sort, days, day_flag, operators, minutes, score, remarks, status, reason, up_time, user_id, user_name, create_time
    </sql>
    
    <select id="findBillTaskByObId" parameterType="java.lang.Long" resultType="com.jayud.mall.model.vo.BillTaskVO">
        select
            t.task_code, t.task_name, t.sort, t.days, t.day_flag, t.minutes, t.score, t.remarks, t.status,
            t1.userName operators, t1.member_user_id userId, t1.userName userName
        from (
                 select
                     t.id orderId,t.task_id,
                     t3.group_code,t3.group_name,
                     t4.task_code,t4.task_name,t4.sort,t4.days,t4.day_flag,t4.minutes,t4.score,t4.remarks,t4.status
                 from (select id,task_id from ocean_bill where id=#{obId}) t
                          left join task_group t3 on t3.id = t.task_id
                          left join bill_task t4 on t4.group_code = t3.group_code
             ) t
                 left join (
            select
                t.id orderId,t.operation_team_id,
                t2.group_code,t2.group_name,
                t3.member_user_id,t3.task_id,
                t4.name userName,
                t5.task_code,t5.task_name
            from (select id,operation_team_id from ocean_bill where id=#{obId}) t
                     left join operation_team t2 on t2.id = t.operation_team_id
                     left join operation_team_member t3 on t3.operation_team_id = t2.id
                     left join system_user t4 on t4.id = t3.member_user_id
                     left join task t5 on t5.id = t3.task_id

        ) t1 on t1.task_code = t.task_code and t1.task_name = t.task_name

    </select>
    

</mapper>
